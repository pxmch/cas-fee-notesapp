"use strict";function Note(e,t,i,o,a,s,n){var d=this;d._id="undefined"!=typeof n?n:null,d.title=e,d.description=t,d.priority="undefined"==typeof i||isNaN(i)?0:i,d.duedate="undefined"==typeof o||isNaN(o)?0:o,d.isDone="undefined"!=typeof a?a:!1,d.createdate=Date.now(),d.finishdate=s}function NoteList(){function e(){try{return localStorage.setItem("test-storage","test"),localStorage.removeItem("test-storage"),!0}catch(e){return!1}}function t(){$.get(n+"/all",function(e){c.items=JSON.parse(e),o()}).fail(function(){window.console&&console.log("loading items failed!")})}function i(){return e()?(localStorage.setItem(s,JSON.stringify(c.items)),void o()):void alert("No local storage available.")}function o(){$(a).trigger("notelist:refresh",[{showFinished:c.showFinished,items:c.items}])}const a=".note_list",s="note-items",n="http://127.0.0.1:3001",d=1,r=2;var c=this;c.items=[],c.showFinished=!1,c.syncState=d,c.resyncQueue=[],c.init=function(){t()},c.getItem=function(e){return c.items[e]},c.addItem=function(e){delete e._id,$.ajax({url:n+"/note",type:"POST",data:JSON.stringify(e),contentType:"application/json; charset=utf-8",crossDomain:!0,success:function(t,o,a){var s=JSON.parse(t);e._id=s._id,c.items.push(e),i()}}).fail(function(){c.syncState=r,c.resyncQueue.push(e),window.console&&console.log("server store failed!"),c.items.push(e),i()})},c.replaceItem=function(e,t){c.items.splice(e,1,t),$.ajax({url:n+"/note/"+t._id,type:"PUT",data:JSON.stringify(t),contentType:"application/json; charset=utf-8",crossDomain:!0}).fail(function(){c.syncState=r,c.resyncQueue.push(t),window.console&&console.log("server store failed!")}),i()},c.deleteItem=function(e,t){c.items.splice(e,1),$.ajax({url:n+"/note/"+t,type:"DELETE",contentType:"application/json; charset=utf-8",crossDomain:!0}).fail(function(){window.console&&console.log("server delete failed!")}),i()},c.toggleShowFinished=function(){return c.showFinished=!c.showFinished,o(),c.showFinished},c.sortItems=function(e,t){switch(e){case"duedate":c.items.sort(function(e,i){return"asc"==t?parseInt(e.duedate)-parseInt(i.duedate):parseInt(i.duedate)-parseInt(e.duedate)});break;case"priority":c.items.sort(function(e,i){return"asc"==t?e.priority-i.priority:i.priority-e.priority});break;case"createdate":c.items.sort(function(e,i){return"asc"==t?parseInt(e.createdate)-parseInt(i.createdate):parseInt(i.createdate)-parseInt(e.createdate)})}i()}}function getFormattedDate(e,t){var i=e,o=i.getMonth()+1,a=i.getDate();return 10>o&&(o="0"+o),10>a&&(a="0"+a),moment.locale("en",{calendar:{lastDay:"[Yesterday]",sameDay:"[Today]",nextDay:"[Tomorrow]",lastWeek:"[last] dddd",nextWeek:"dddd",sameElse:"DD.MM.YYYY"}}),t?moment(""+i.getFullYear()+o+a,"YYYYMMDD").calendar():i.getFullYear()+"-"+o+"-"+a}function getToday(){return getFormattedDate(new Date(Date.now()),!1)}function getTomorrow(){return getFormattedDate(new Date(Date.now()+864e5),!1)}function setCookie(e,t,i){document.cookie=e+"="+encodeURIComponent(t)+"; max-age="+86400*i+"; path=/"}function getCookie(e){var t=document.cookie;if(t&&0!=t.length){var i=t.match("(^|;)[s]*"+e+"=([^;]*)");if(i&&i[2])return decodeURIComponent(i[2])}return""}function toggleEditMask(e){"show"==e?($(".edit-dialog-backdrop").addClass("active"),$(".edit-dialog").addClass("active"),"add"===$(".edit-dialog").data("mode")&&$(".edit-mask-delete-button").hide()):($(".edit-dialog-backdrop").removeClass("active"),$(".edit-dialog").removeClass("active").data("mode","").data("index",""),$("#edit-mask")[0].reset(),$(".edit-mask-delete-button").show())}function updateSortIndicators(e,t){$(".js-sort-indicator").removeClass("fa-sort fa-sort-asc fa-sort-desc").parent().removeClass("active"),e.find(".js-sort-indicator").addClass("fa-sort-"+t).parent().addClass("active")}function initTheme(){getCookie(THEME_COOKIE_NAME)===THEME_CLASS_NAME&&$("body").addClass(THEME_CLASS_NAME)}function initDescriptionMoreLinks(){$(".js-note_item__description").each(function(){$(this).height()<$(this).find(".note_item__description-wrapper").height()&&$(this).append('<span class="note_item__description-more"><i class="fa fa-plus-square-o" aria-hidden="true"></span>')})}$(".note_list").on("notelist:refresh",function(e,t){var i=$("#node_item_template").html(),o=Handlebars.compile(i),a=t;$(".note_list").html(o(a)),initDescriptionMoreLinks()}),$(".js-button-add-item").on("click",function(){$("#edit-menu-title").text("Add note"),$(".edit-dialog").data("mode","add"),toggleEditMask("show")}),$(".js-menu-toggle").on("click",function(){$(".app-toolbar").toggleClass("app-toolbar--hidden")}),$(".js-style-toggle").on("click",function(){$("body").toggleClass(THEME_CLASS_NAME);var e=$("body").hasClass(THEME_CLASS_NAME)?THEME_CLASS_NAME:"default";setCookie(THEME_COOKIE_NAME,e,30)}),$("#js-sort-by-duedate").on("click",function(){$(this).toggleClass("desc");var e=$(this).hasClass("desc")?"desc":"asc";TheNoteList.sortItems("duedate",e),updateSortIndicators($(this),e)}),$("#js-sort-by-createdate").on("click",function(){$(this).toggleClass("desc");var e=$(this).hasClass("desc")?"desc":"asc";TheNoteList.sortItems("createdate",e),updateSortIndicators($(this),e)}),$("#js-sort-by-priority").on("click",function(){$(this).toggleClass("desc");var e=$(this).hasClass("desc")?"desc":"asc";TheNoteList.sortItems("priority",e),updateSortIndicators($(this),e)}),$("#js-filter-done").on("click",function(){var e=TheNoteList.toggleShowFinished()?"eye":"eye-slash";$(this).find(".js-filter-done-indicator").removeClass("fa-eye fa-eye-slash").addClass("fa-"+e)}),$(".note_list").on("click",".js-button-edit-item",function(){var e=$(this).data("id"),t=TheNoteList.getItem(e);$("#edit-id").val(t._id),$("#edit-isDone").val(t.isDone),$("#edit-title").val(t.title),$("#edit-description").val(t.description),$('input[name="edit-priority"][value="'+t.priority+'"]').prop("checked",!0);var i=t.finishdate,o=""!=i&&0!=i?i:0;t.finishdate=o,$("#edit-finishdate").val(getFormattedDate(new Date(t.finishdate)),!1),0!==t.duedate&&$("#edit-duedate").val(getFormattedDate(new Date(t.duedate)),!1),$("#edit-menu-title").text("Edit note"),toggleEditMask("show"),$(".edit-dialog").data("mode","edit").data("index",e)}),$(".note_list").on("click",".js-item-flag-done",function(){var e=TheNoteList.getItem($(this).data("id"));$(this).prop("checked")?(e.isDone=!0,e.finishdate=Date.now()):(e.isDone=!1,e.finishdate=0),TheNoteList.replaceItem($(this).data("id"),e)}),$(".note_list").on("click",".js-note_item__description",function(){$(this).toggleClass("note_item__description--expanded");var e=$(this).find(".note_item__description-more .fa");e.removeClass("fa-plus-square-o fa-minus-square-o"),e.addClass($(this).hasClass("note_item__description--expanded")?"fa-minus-square-o":"fa-plus-square-o")}),$(window).on("resize",function(){clearTimeout(resizeTimer),resizeTimer=setTimeout(function(){initDescriptionMoreLinks()},200)}),$(".js-button-item-cancel").on("click",function(){toggleEditMask("hide")}),$(".js-btn-item-save").on("click",function(){var e=$("#edit-title").val(),t=$("#edit-description").val(),i=0,o=0,a=$("#edit-finishdate").val(),s=$("#edit-id").val(),n=!1;"edit"==$(".edit-dialog").data("mode")&&(n="true"==$("#edit-isDone").val()),$('input[name="edit-priority"]:checked').val()&&(i=parseInt($('input[name="edit-priority"]:checked').val())),""!==$("#edit-duedate").val()&&(o=Date.parse($("#edit-duedate").val()));var d=new Note(e,t,i,o,n,a,s);if("edit"==$(".edit-dialog").data("mode")){var r=$(".edit-dialog").data("index");TheNoteList.replaceItem(r,d)}else TheNoteList.addItem(d);toggleEditMask("hide")}),$(".js-button-delete-item").on("click",function(){if(window.confirm("Delete this note?")){var e=$(".edit-dialog").data("index"),t=$("#edit-id").val();TheNoteList.deleteItem(e,t),toggleEditMask("hide")}}),$(".js-btn-duedate-today").on("click",function(){$("#edit-duedate").val(getToday())}),$(".js-btn-duedate-tomorrow").on("click",function(){$("#edit-duedate").val(getTomorrow())}),$(".js-btn-reset-prio").on("click",function(){$(".edit-priority").attr("checked",!1)}),Handlebars.registerHelper("formattedDate",function(e){if(0===e)return"";var t=new Date(e);return getFormattedDate(t,!0)});const THEME_COOKIE_NAME="theme",THEME_CLASS_NAME="theme-compact";var resizeTimer,TheNoteList=new NoteList;TheNoteList.init(),initTheme(),initDescriptionMoreLinks();